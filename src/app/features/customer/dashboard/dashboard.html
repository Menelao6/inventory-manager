<div class="customer-container">
    <div class="customer-header">
        <div>
            <h2 class="page-title">Our Products</h2>
            <p class="page-subtitle">Browse and add items to your cart</p>
        </div>
        <button class="cart-button" (click)="toggleCart()">
            <span class="cart-icon">ðŸ›’</span>
            <span class="cart-text">Basket</span>
            @if (cart.length > 0) {
                <span class="cart-badge">{{ cart.length }}</span>
            }
        </button>
    </div>
    
    <div class="products-grid">
        @for (product of products$ | async; track product.id) {
            <div class="product-card">
                <img [src]="product.imageUrl" [alt]="product.name" class="product-image" />
                <div class="product-info">
                    <h3 class="product-name">{{ product.name }}</h3>
                    <p class="product-description">{{ product.description }}</p>
                    <div class="product-meta">
                        <span class="product-category">{{ product.category }}</span>
                        <span class="product-stock" [class.low-stock]="product.quantity < 10">
                            Stock: {{ product.quantity }}
                        </span>
                    </div>
                    <div class="product-footer">
                        <span class="product-price">${{ product.price }}</span>
                        
                        @if (isInCart(product.id)) {
                            <div class="quantity-controls">
                                <button class="qty-btn" (click)="decreaseQuantity(getCartItem(product.id)!)">
                                    âˆ’
                                </button>
                                <span class="qty-display">{{ getCartItem(product.id)!.quantity }}</span>
                                <button 
                                    class="qty-btn" 
                                    (click)="increaseQuantity(getCartItem(product.id)!)"
                                    [disabled]="getCartItem(product.id)!.quantity >= product.quantity">
                                    +
                                </button>
                            </div>
                        } @else {
                            <button 
                                class="btn-add-to-cart" 
                                (click)="addToCart(product)"
                                [disabled]="product.quantity === 0">
                                @if (product.quantity === 0) {
                                    Out of Stock
                                } @else {
                                    Add to Cart
                                }
                            </button>
                        }
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@if (showCart) {
    <div class="cart-overlay" (click)="toggleCart()"></div>
    <div class="cart-sidebar" [class.open]="showCart">
        <div class="cart-header">
            <h3 class="cart-title">Shopping Cart</h3>
            <button class="cart-close" (click)="toggleCart()">Ã—</button>
        </div>
        
        <div class="cart-body">
            @if (cart.length === 0) {
                <div class="cart-empty">
                    <div class="empty-cart-icon">ðŸ›’</div>
                    <p>Your cart is empty</p>
                    <span class="empty-cart-text">Add some products to get started!</span>
                </div>
            } @else {
                <div class="cart-items">
                    @for (item of cart; track item.product.id) {
                        <div class="cart-item">
                            <img [src]="item.product.imageUrl" [alt]="item.product.name" class="cart-item-image">
                            <div class="cart-item-details">
                                <h4 class="cart-item-name">{{ item.product.name }}</h4>
                                <p class="cart-item-price">${{ item.product.price }} Ã— {{ item.quantity }}</p>
                                <div class="cart-item-controls">
                                    <div class="quantity-controls-small">
                                        <button class="qty-btn-small" (click)="decreaseQuantity(item)">âˆ’</button>
                                        <span class="qty-display-small">{{ item.quantity }}</span>
                                        <button 
                                            class="qty-btn-small" 
                                            (click)="increaseQuantity(item)"
                                            [disabled]="item.quantity >= item.product.quantity">
                                            +
                                        </button>
                                    </div>
                                    <button class="btn-remove" (click)="removeFromCart(item.product)">
                                        Remove
                                    </button>
                                </div>
                            </div>
                            <div class="cart-item-total">
                                ${{ item.product.price * item.quantity | number:'1.2-2' }}
                            </div>
                        </div>
                    }
                </div>
                
                <div class="cart-summary">
                    <div class="summary-row">
                        <span class="summary-label">Subtotal</span>
                        <span class="summary-value">${{ getCartTotal() | number:'1.2-2' }}</span>
                    </div>
                    <div class="summary-row total">
                        <span class="summary-label">Total</span>
                        <span class="summary-value">${{ getCartTotal() | number:'1.2-2' }}</span>
                    </div>
                </div>
            }
        </div>
        
        <div class="cart-footer">
            @if (cart.length > 0) {
                <button class="btn-clear" (click)="clearCart()">
                    Clear Cart
                </button>
                <button class="btn-checkout" (click)="placeOrder()">
                    Place Order
                </button>
            }
        </div>
    </div>
}

@if (showSuccessModal) {
    <div class="modal-overlay" (click)="closeSuccessModal()">
        <div class="modal-container success-modal" (click)="$event.stopPropagation()">
            <div class="modal-body">
                <div class="success-icon">âœ…</div>
                <h3 class="success-title">Order Placed Successfully!</h3>
                <p class="success-message">Your order has been placed and is now pending. You can track it in the manager dashboard.</p>
                <div class="order-summary-box">
                    <div class="summary-item">
                        <span class="summary-label">Total Items:</span>
                        <span class="summary-value">{{ orderSummary.itemCount }}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Total Amount:</span>
                        <span class="summary-value total">${{ orderSummary.total | number:'1.2-2' }}</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn btn-primary" (click)="closeSuccessModal()">
                    Continue Shopping
                </button>
            </div>
        </div>
    </div>
}