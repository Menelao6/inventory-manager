<div class="orders-container">
    <div class="orders-header">
        <div>
            <h2 class="orders-title">Order Management Dashboard</h2>
            <p class="orders-subtitle">Track and manage all your customer orders</p>
        </div>
        <button class="action-btn btn-sell" (click)="openSellModal()">
            <span class="btn-icon">üí≥</span>
            Sell Product
        </button>
    </div>

    @if (orders$ | async; as orders) {
        @if (orders.length === 0) {
            <div class="empty-state">
                <div class="empty-icon">üì¶</div>
                <h3>No orders yet</h3>
                <p>Orders will appear here once customers start placing them</p>
            </div>
        } @else {
            <div class="orders-grid">
                @for (order of orders; track order.id) {
                    <div class="order-card">
                        <div class="order-card-header">
                            <div class="order-id-section">
                                <span class="order-label">Order ID</span>
                                <span class="order-id">#{{order.id}}</span>
                            </div>
                            <span class="order-status" [class]="'status-' + order.status.toLowerCase()">
                                {{order.status}}
                            </span>
                        </div>
                        
                        <div class="order-card-body">
                            <div class="order-detail">
                                <span class="detail-icon">üë§</span>
                                <div class="detail-content">
                                    <span class="detail-label">Customer</span>
                                    <span class="detail-value">{{order.customer}}</span>
                                </div>
                            </div>
                            
                            <div class="order-detail">
                                <span class="detail-icon">üìÖ</span>
                                <div class="detail-content">
                                    <span class="detail-label">Order Date</span>
                                    <span class="detail-value">{{order.createdAt | date:'medium'}}</span>
                                </div>
                            </div>
                            
                            <div class="order-detail">
                                <span class="detail-icon">üì¶</span>
                                <div class="detail-content">
                                    <span class="detail-label">Items</span>
                                    <span class="detail-value">{{order.quantity}}</span>
                                </div>
                            </div>
                            
                            <div class="order-detail">
                                <span class="detail-icon">üí∞</span>
                                <div class="detail-content">
                                    <span class="detail-label">Total Amount</span>
                                    <span class="detail-value total-amount">{{order.total | currency}}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="order-card-footer">
                            <button class="action-btn btn-view" (click)="viewDetails(order)">
                                View Details
                            </button>
                            <button class="action-btn btn-process" (click)="processOrder(order)">
                                Process
                            </button>
                            <button class="action-btn btn-cancel" (click)="cancelOrder(order.id)">
                                Cancel
                            </button>
                        </div>
                    </div>
                }
            </div>
        }
    } @else {
        <div class="loading-state">
            <div class="spinner"></div>
            <p>Loading orders...</p>
        </div>
    }
</div>

<!-- Sell Product Modal -->
@if (showSellModal) {
    <div class="modal-overlay" (click)="closeSellModal()">
        <div class="modal-container sell-modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">Sell Product</h3>
                <button class="modal-close" (click)="closeSellModal()">√ó</button>
            </div>
            
            <form [formGroup]="form" (ngSubmit)="sellProducts()">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="productId" class="form-label">Select Product *</label>
                        <select id="productId" class="form-select" formControlName="productId">
                            <option [ngValue]="null" disabled>Choose a product...</option>
                            @for (p of productsList; track p.id) {
                                <option [ngValue]="p.id">
                                    {{ p.name }} - {{ p.price | currency }} (Stock: {{ p.quantity }})
                                </option>
                            }
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="quantity" class="form-label">Quantity *</label>
                        <input 
                            type="number" 
                            id="quantity" 
                            class="form-input" 
                            formControlName="quantity" 
                            min="1"
                            placeholder="Enter quantity">
                    </div>
                    
                    @if (selectedProduct) {
                        <div class="product-summary">
                            <div class="summary-header">
                                <span class="summary-icon">üìä</span>
                                <h4>Order Summary</h4>
                            </div>
                            <div class="summary-details">
                                <div class="summary-row">
                                    <span class="summary-label">Product:</span>
                                    <span class="summary-value">{{ selectedProduct.name }}</span>
                                </div>
                                <div class="summary-row">
                                    <span class="summary-label">Unit Price:</span>
                                    <span class="summary-value">{{ selectedProduct.price | currency }}</span>
                                </div>
                                <div class="summary-row">
                                    <span class="summary-label">Quantity:</span>
                                    <span class="summary-value">{{ form.value.quantity || 0 }}</span>
                                </div>
                                <div class="summary-row total-row">
                                    <span class="summary-label">Total:</span>
                                    <span class="summary-value total">{{ calculateTotal() | currency }}</span>
                                </div>
                            </div>
                        </div>
                    }
                    
                    @if (form.invalid && (form.dirty || form.touched)) {
                        <div class="form-error">
                            <span class="error-icon">‚ö†Ô∏è</span>
                            Please select a product and enter a valid quantity.
                        </div>
                    }
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="modal-btn btn-cancel" (click)="closeSellModal()">
                        Cancel
                    </button>
                    <button type="submit" class="modal-btn btn-submit" [disabled]="form.invalid">
                        Complete Sale
                    </button>
                </div>
            </form>
        </div>
    </div>
}

<!-- View Order Details Modal -->
@if (showViewModal && selectedOrder) {
    <div class="modal-overlay" (click)="closeViewModal()">
        <div class="modal-container view-modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">Order Details</h3>
                <button class="modal-close" (click)="closeViewModal()">√ó</button>
            </div>
            
            <div class="modal-body">
                <div class="order-details-grid">
                    <div class="detail-card">
                        <div class="detail-card-icon">üÜî</div>
                        <div class="detail-card-content">
                            <span class="detail-card-label">Order ID</span>
                            <span class="detail-card-value">#{{ selectedOrder.id }}</span>
                        </div>
                    </div>
                    
                    <div class="detail-card">
                        <div class="detail-card-icon">üë§</div>
                        <div class="detail-card-content">
                            <span class="detail-card-label">Customer</span>
                            <span class="detail-card-value">{{ selectedOrder.customer }}</span>
                        </div>
                    </div>
                    
                    <div class="detail-card">
                        <div class="detail-card-icon">üì¶</div>
                        <div class="detail-card-content">
                            <span class="detail-card-label">Product</span>
                            <span class="detail-card-value">{{ selectedOrder.productName }}</span>
                        </div>
                    </div>
                    
                    <div class="detail-card">
                        <div class="detail-card-icon">üìÖ</div>
                        <div class="detail-card-content">
                            <span class="detail-card-label">Order Date</span>
                            <span class="detail-card-value">{{ selectedOrder.createdAt | date:'medium' }}</span>
                        </div>
                    </div>
                    
                    <div class="detail-card">
                        <div class="detail-card-icon">üî¢</div>
                        <div class="detail-card-content">
                            <span class="detail-card-label">Quantity</span>
                            <span class="detail-card-value">{{ selectedOrder.quantity }} units</span>
                        </div>
                    </div>
                    
                    <div class="detail-card">
                        <div class="detail-card-icon">üíµ</div>
                        <div class="detail-card-content">
                            <span class="detail-card-label">Unit Price</span>
                            <span class="detail-card-value">{{ selectedOrder.unitPrice | currency }}</span>
                        </div>
                    </div>
                    
                    <div class="detail-card highlight">
                        <div class="detail-card-icon">üí∞</div>
                        <div class="detail-card-content">
                            <span class="detail-card-label">Total Amount</span>
                            <span class="detail-card-value total">{{ selectedOrder.total | currency }}</span>
                        </div>
                    </div>
                    
                    <div class="detail-card">
                        <div class="detail-card-icon">üìä</div>
                        <div class="detail-card-content">
                            <span class="detail-card-label">Status</span>
                            <span class="status-badge" [class]="'status-' + selectedOrder.status.toLowerCase()">
                                {{ selectedOrder.status }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="modal-btn btn-secondary" (click)="closeViewModal()">
                    Close
                </button>
                <button type="button" class="modal-btn btn-process" (click)="processOrder(selectedOrder); closeViewModal()">
                    Process Order
                </button>
            </div>
        </div>
    </div>
}

<!-- Cancel Confirmation Modal -->
@if (showCancelModal) {
    <div class="modal-overlay" (click)="showCancelModal = false">
        <div class="modal-container cancel-modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">Cancel Order</h3>
                <button class="modal-close" (click)="showCancelModal = false">√ó</button>
            </div>
            <div class="modal-body">
                <div class="cancel-icon">‚ö†Ô∏è</div>
                <p class="cancel-message">Are you sure you want to cancel order <strong>#{{orderToCancel}}</strong>?</p>
                <p class="cancel-warning">This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn btn-secondary" (click)="showCancelModal = false">
                    No, Keep Order
                </button>
                <button class="modal-btn btn-danger" (click)="confirmCancel()">
                    Yes, Cancel Order
                </button>
            </div>
        </div>
    </div>
}